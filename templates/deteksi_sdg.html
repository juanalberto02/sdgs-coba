<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Book - LIPJPHKI</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=ABeeZee&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Afacad&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Afacad+Flux&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Almarai&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Amaranth&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Amiri&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Amiri+Quran&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Antic&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Atkinson+Hyperlegible&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Average&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Average+Sans&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bebas+Neue&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Chela+One&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Chelsea+Market&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cormorant&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cormorant+Garamond&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cormorant+Infant&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Crimson+Pro&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Crimson+Text&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Animated-Type-Heading.css">
    <link rel="stylesheet" href="assets/css/baguetteBox.min.css">
    <link rel="stylesheet" href="assets/css/Custom-Upload-File.css">
    <link rel="stylesheet" href="assets/css/Data-Table-styles.css">
    <link rel="stylesheet" href="assets/css/Data-Table.css">
    <link rel="stylesheet" href="assets/css/Drag--Drop-Upload-Form.css">
    <link rel="stylesheet" href="assets/css/Drag-Drop-File-Input-Upload.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/css/theme.bootstrap_4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="assets/css/Ludens---1-Index-Table-with-Search--Sort-Filters-v20.css">
    <link rel="stylesheet" href="assets/css/Table-With-Search-search-table.css">
    <link rel="stylesheet" href="assets/css/Table-With-Search.css">
</head>

<body>
    <nav class="navbar navbar-expand-md sticky-top bg-success shadow-sm py-md-3:"
        style="--bs-warning: #ffd024;--bs-warning-rgb: 255,208,36;--bs-success: #0165a4;--bs-success-rgb: 1,101,164;">
        <div class="container">
        <img src="assets/img/Unair Branding.png" height="60" class="ms-lg-0 me-lg-0 ps-lg-0">
        <a class="navbar-brand" href="#"></a>
        <button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1">
          <span class="visually-hidden">Toggle navigation</span>
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse text-warning ms-lg-0 ps-lg-0" id="navcol-1"
              style="font-family: 'Inter';font-size: 16px;color: rgb(255,255,255);">
          <ul class="navbar-nav mx-auto ps-lg-0" style="color: rgb(255,255,255);font-size: 16px;">
            <li class="nav-item"></li>
            <li class="nav-item"></li>
          </ul>
          <a class="btn btn-primary fw-normal lh-1 bg-light border rounded-pill" role="button"
              style="background: rgb(3,99,161);--bs-success: #0165a4;--bs-success-rgb: 1,101,164;font-family: 'Inter';color: rgb(1,101,164);font-size: 16px;"
              href="{{ request.url_for('logout') }}">Logout</a>
        </div>
        </div>
      </nav>
    <section class="my-5">
        <div class="container">
            <div class="row" style="font-family: 'Inter';">
                <div class="col-lg-3">
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-1 mb-5 mb-md-3">
                        <div class="col-sm-8 order-sm-first order-lg-last" style="font-family: Inter, sans-serif;font-size: 12;">
                            <h3 class="mb-1" style="text-align: center;font-size: 22px;font-weight: bold;color: rgb(1,101,164);">UPLOAD RESEARCH</h3>
                            <p style="text-align: center;font-size: 12px;">Upload your research document in pdf format.</p>   
                            <form method="post" action="/deteksi" enctype="multipart/form-data">
                                <div class="files color form-group mb-3" style="text-align:center;">
                                    <input class="form-control-sm ms-0 pt-5 ps-5 pe-2 me-0 me-lg-0 pt-lg-5 ps-lg-5 pe-lg-4 mb-lg-0"
                                           type="file"
                                           name="pdf_file"
                                           style="font-family: 'Inter';background: rgba(207,220,214,0.06);color: rgba(0,0,0,0.48);font-size: 10.6px;"
                                           accept=".pdf"
                                           required>
                                </div>
                                <button class="btn btn-primary border rounded-pill d-block w-100 mb-lg-3"
                                        type="submit"
                                        style="color: rgb(255,255,255);background: rgb(1,101,164);border-bottom-style: none;">
                                    Upload
                                </button>
                            </form>  
                            <div id="taq-block">
                                <h3 class="fs-6 fw-bold text-primary" style="text-align: justify;font-size: 12px;">Title</h3>
                                <p taq-title style="text-align: justify;font-size: 12px;">{{ title or '-' }}</p>
                                <h3 class="fs-6 fw-bold text-primary" style="text-align: justify;font-size: 12px;">Abstract</h3>
                                <p taq-abstract style="text-align: justify;font-size: 12px;">{{ abstract or '-' }}</p>
                                <h3 class="fs-6 fw-bold text-primary" style="text-align: justify;font-size: 12px;">Keywords</h3>
                                <p taq-keywords style="text-align: justify;font-size: 12px;">{{ keywords or '-' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 offset-lg-1">
                    <div id="sdg-result-block" style="display:none;">
                        <div class="row mb-5">
                            <div class="col">
                                <h2 class="fs-5 fw-bold text-primary mb-3">SDGs Achieved</h2>
                                <div class="row gx-2 gy-2 row-cols-1 row-cols-md-2 row-cols-lg-3" id="sdg-cards-list"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <h3 class="mb-0" style="font-size: 30px;font-weight: bold;text-align: center;font-style: italic;color: rgb(1,101,164);">INCLUSION RULE</h3>
                            <p style="text-align: center;">Terms that can be matched in the Title, Abstract, and Keywords</p>
                            <div id="inclusion-rules-block"></div>
                        </div>
                        <h3 class="mt-5 mb-0" style="font-size: 30px;text-align: center;font-style: italic;font-weight: bold;color: rgb(164,1,1);">EXCLUSION RULE</h3>
                        <p style="text-align: center;">Terms that must be removed from the Title, Abstract, and Keywords</p>
                        <div id="exclusion-rules-block"></div>
                        <h3 class="mt-5 mb-0" style="font-size: 30px;text-align: center;font-style: italic;font-weight: bold;color: rgb(0,0,0);">COMPLETE RULES</h3>
                        <p style="text-align: center;">Details for Inclusion and Exclusion Rule</p>
                        <table class="table table-striped table-bordered" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th>SDG</th>
                                    <th>Similarity (%)</th>
                                    <th>Required Words</th>
                                    <th>Unnecessary Words</th>
                                </tr>
                            </thead>
                            <tbody id="sdg-table-body"></tbody>
                        </table>
                    </div>
                    <div id="sdg-empty-block">
                        <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 350px;">
                            <i class="bi bi-file-earmark-arrow-up" style="font-size: 56px; color: #0165a4; margin-bottom: 18px;"></i>
                            <h4 class="fw-semibold text-primary mb-1" style="font-size: 1.4rem;">No SDG results yet</h4>
                            <p class="text-muted" style="font-size: 1.1rem;">Please upload your PDF to see SDG detection results.</p>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </section>
    <footer class="text-center bg-success" style="background: rgb(0,85,255);--bs-success: #0165a4;--bs-success-rgb: 1,101,164;">
        <div class="container py-4 py-lg-5"><img src="assets/img/Unair Branding.png" height="60" class="ms-lg-0 me-lg-0 ps-lg-0">
            <p class="lead pb-lg-0 mb-lg-2" style="font-size: 12px;color: rgb(255,255,255);font-family: 'Inter';"> Copyright © 2025 UNAIR</p>
            <ul class="list-inline" style="color: rgb(248,248,248);">
                <li class="list-inline-item"><a class="link-body-emphasis" href="https://x.com/Unair_Official"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-brand-x" style="color: rgb(255,255,255);">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <path d="M4 4l11.733 16h4.267l-11.733 -16z"></path>
                            <path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path>
                        </svg></a></li>
                <li class="list-inline-item"><a class="link-body-emphasis" href="https://www.instagram.com/univ_airlangga/"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-brand-instagram" style="color: rgb(255,255,255);">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <path d="M4 4m0 4a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-8a4 4 0 0 1 -4 -4z"></path>
                            <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
                            <path d="M16.5 7.5l0 .01"></path>
                        </svg></a></li>
                <li class="list-inline-item"><a class="link-body-emphasis" href="https://www.youtube.com/channel/UCUYwloXmWyNZplsqg4MVERw"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-brand-youtube" style="color: rgb(255,255,255);">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <path d="M2 8a4 4 0 0 1 4 -4h12a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-12a4 4 0 0 1 -4 -4v-8z"></path>
                            <path d="M10 9l5 3l-5 3z"></path>
                        </svg></a></li>
            </ul>
        </div>
    </footer>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
    <script src="assets/js/Animated-Type-Heading-type-headline.js"></script>
    <script src="assets/js/baguetteBox.min.js"></script>
    <script src="assets/js/Custom-Upload-File-upload_file.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/js/jquery.tablesorter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/js/widgets/widget-filter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/js/widgets/widget-storage.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="assets/js/Ludens---1-Index-Table-with-Search--Sort-Filters-v20-Ludens---1-Index-Table-with-Search--Sort-Filters.js"></script>
    <script src="assets/js/Ludens---1-Index-Table-with-Search--Sort-Filters-v20-Ludens---Material-UI-Actions.js"></script>
    <script src="assets/js/Table-With-Search-search-table.js"></script>
    <script src="assets/js/template.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Ambil variabel Jinja dari backend (atau isi dengan default kosong)
            let title = {{ title|tojson|safe }};
            let abstract = {{ abstract|tojson|safe }};
            let keywords = {{ keywords|tojson|safe }};
            let topRules = {{ top_rules|tojson|safe }};
        
            // Cek apakah hasil upload ini valid atau tidak
            let hasBackendData = topRules && Array.isArray(topRules) && topRules.length > 0;
        
            // Jika ada hasil dari backend (upload berhasil), simpan/update localStorage & tampilkan
            if (hasBackendData) {
                localStorage.setItem("deteksi_result", JSON.stringify({
                    title: title,
                    abstract: abstract,
                    keywords: keywords,
                    top_rules: topRules
                }));
        
                showSDGResult(topRules);
                document.getElementById("sdg-result-block").style.display = "block";
                document.getElementById("sdg-empty-block").style.display = "none";
            } else {
                // Kalau tidak ada hasil upload, cek localStorage
                let result = localStorage.getItem("deteksi_result");
                if (result) {
                    let parsed = JSON.parse(result);
                    // Isi kiri (title/abstract/keywords) juga!
                    document.querySelector('[taq-title]').innerText = parsed.title || '-';
                    document.querySelector('[taq-abstract]').innerText = parsed.abstract || '-';
                    document.querySelector('[taq-keywords]').innerText = parsed.keywords || '-';
        
                    // Isi kanan
                    if (parsed.top_rules && parsed.top_rules.length > 0) {
                        showSDGResult(parsed.top_rules);
                        document.getElementById("sdg-result-block").style.display = "block";
                        document.getElementById("sdg-empty-block").style.display = "none";
                    } else {
                        document.getElementById("sdg-result-block").style.display = "none";
                        document.getElementById("sdg-empty-block").style.display = "block";
                    }
                } else {
                    // Tidak ada data sama sekali, kosongkan
                    document.getElementById("sdg-result-block").style.display = "none";
                    document.getElementById("sdg-empty-block").style.display = "block";
                }
            }
        
            // FUNGSI UTAMA: render kanan
            function showSDGResult(top_rules) {
                // --- SDG Cards ---
                let cardsHtml = "";
                top_rules.forEach(row => {
                    cardsHtml += `
                        <div class="col">
                            <div class="card border-0 project-item">
                                <a class="stretched-link text-decoration-none" href="sdgs_detail/sdg_${String(row.sdg).padStart(2, '0')}.html"></a>
                                <img class="card-img w-100 d-block card-img-top" src="assets/img/projects/E_SDG_PRINT-${String(row.sdg).padStart(2, '0')}.jpg">
                                <div class="card-img-overlay text-white"></div>
                            </div>
                        </div>`;
                });
                document.getElementById("sdg-cards-list").innerHTML = cardsHtml;
        
                // --- Inclusion Rule ---
                let incHtml = "";
                top_rules.forEach(row => {
                    incHtml += `
                    <div class="d-md-flex p-3 mb-3" style="background: #bce3fa; border-radius: 24px;">
                        <div style="flex: 0 0 30%; max-width: 30%; color: #003d7a; display: flex; flex-direction: column; justify-content: center;">
                            <p class="mb-0" style="font-size: 28px; font-weight: bold;">SDG ${String(row.sdg).padStart(2, '0')}</p>
                            <p class="mb-0" style="font-size: 18px;">${(row.similarity * 100).toFixed(1)}%</p>
                        </div>
                        <div style="flex: 0 0 70%; max-width: 70%; padding-left: 20px; display: flex; flex-direction: column; justify-content: center;">
                            <span style="font-weight: bold; font-style: italic;">Required words</span>
                            <span>${row.required_words}</span>
                        </div>
                    </div>`;
                });
                document.getElementById("inclusion-rules-block").innerHTML = incHtml;
        
                // --- Exclusion Rule ---
                let excHtml = "";
                top_rules.forEach(row => {
                    excHtml += `
                    <div class="d-md-flex p-3 mb-3" style="background: #fec2c2; border-radius: 24px;">
                        <div style="flex: 0 0 30%; max-width: 30%; color: #7a0000; display: flex; flex-direction: column; justify-content: center;">
                            <p class="mb-0" style="font-size: 28px; font-weight: bold;">SDG ${String(row.sdg).padStart(2, '0')}</p>
                        </div>
                        <div style="flex: 0 0 70%; max-width: 70%; padding-left: 20px; display: flex; flex-direction: column; justify-content: center;">
                            <span style="font-weight: bold; font-style: italic;">Unnecessary words</span>
                            <span>${row.unnecessary_words}</span>
                        </div>
                    </div>`;
                });
                document.getElementById("exclusion-rules-block").innerHTML = excHtml;
        
                // --- Table ---
                let tableHtml = "";
                top_rules.forEach(row => {
                    tableHtml += `
                        <tr>
                            <td>SDG ${String(row.sdg).padStart(2, '0')}</td>
                            <td>${(row.similarity * 100).toFixed(2)}</td>
                            <td>${row.required_words}</td>
                            <td>${row.unnecessary_words}</td>
                        </tr>`;
                });
                document.getElementById("sdg-table-body").innerHTML = tableHtml;
            }
        });
        </script>
        
        
        
</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Get all SDG values mentioned in the detection result
        const detectedSDGs = new Set();
        const sdgParagraphs = document.querySelectorAll("p");
    
        sdgParagraphs.forEach(p => {
            const text = p.textContent.trim();
            if (/^SDG\s\d{2}$/.test(text)) {
                detectedSDGs.add(text); // e.g., "SDG 01"
            }
        });
    
        // Show only matching SDG cards
        const cards = document.querySelectorAll('[data-bss-type="blog-loop-item"]');
        cards.forEach(card => {
            const sdg = card.getAttribute("data-sdg");
            if (!detectedSDGs.has(sdg)) {
                card.style.display = "none"; // hide cards not matching SDG list
            }
        });
    });
    </script>

</html>